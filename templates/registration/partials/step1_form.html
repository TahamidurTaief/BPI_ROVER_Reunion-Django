<div class="form-modern relative" data-aos="fade-in">
    <form 
        hx-post="{% url 'htmx_post_step1_form' %}"
        hx-target="#registration-form-container"
        hx-swap="innerHTML"
        class="relative z-10"
    >
        {% csrf_token %}
        
        <!-- Step Indicator -->
        <div class="form-step-indicator">
            <div class="step-dot active sans">১</div>
            <div class="step-line"></div>
            <div class="step-dot sans">২</div>
        </div>
        
        <h2 class="form-title sans">
            <i data-lucide="clipboard-list" class="inline-block w-8 h-8 mb-2"></i>
            ব্যক্তিগত তথ্য দিন
        </h2>
        <p class="text-center mb-8 serif text-gray-600 dark:text-gray-400">
            অনুগ্রহ করে নিচের ফর্মটি সঠিক তথ্য দিয়ে পূরণ করুন
        </p>

        {% if errors.general %}
            <div role="alert" class="alert alert-error mb-6">
                <i data-lucide="alert-circle" class="w-6 h-6"></i>
                <span class="font-semibold serif">{{ errors.general }}</span>
            </div>
        {% endif %}

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-5">
            
            <div class="form-group">
                <label class="form-label sans">
                    <i data-lucide="user" class="w-4 h-4"></i>
                    <span>নাম (Name)</span>
                </label>
                <input 
                    type="text" 
                    name="name" 
                    value="{{ data.name|default:'' }}" 
                    placeholder="আপনার পূর্ণ নাম লিখুন" 
                    class="form-input sans {% if errors.name %}error{% endif %}" 
                    required
                />
                {% if errors.name %}
                <span class="form-error sans"><i data-lucide="alert-circle" class="w-3 h-3"></i> {{ errors.name }}</span>
                {% endif %}
            </div>

            <div class="form-group">
                <label class="form-label sans">
                    <i data-lucide="calendar" class="w-4 h-4"></i>
                    <span>সেশন (Session)</span>
                </label>
                <input 
                    type="text" 
                    name="session" 
                    value="{{ data.session|default:'' }}" 
                    placeholder="যেমন: 2010-11" 
                    class="form-input sans {% if errors.session %}error{% endif %}" 
                    required
                />
                {% if errors.session %}
                <span class="form-error sans"><i data-lucide="alert-circle" class="w-3 h-3"></i> {{ errors.session }}</span>
                {% endif %}
            </div>

            <div class="form-group">
                <label class="form-label sans">
                    <i data-lucide="phone" class="w-4 h-4"></i>
                    <span>মোবাইল নম্বর (Contact)</span>
                </label>
                <input 
                    type="tel" 
                    name="contact_number" 
                    value="{{ data.contact_number|default:'' }}" 
                    placeholder="যেমন: 01712345678" 
                    class="form-input sans {% if errors.contact_number %}error{% endif %}" 
                    required
                />
                {% if errors.contact_number %}
                <span class="form-error sans"><i data-lucide="alert-circle" class="w-3 h-3"></i> {{ errors.contact_number }}</span>
                {% endif %}
            </div>

            <div class="form-group">
                <label class="form-label sans">
                    <i data-lucide="graduation-cap" class="w-4 h-4"></i>
                    <span>বিভাগ (Department)</span>
                </label>
                <input 
                    type="text" 
                    name="department" 
                    value="{{ data.department|default:'' }}" 
                    placeholder="যেমন: CSE, EEE" 
                    class="form-input sans {% if errors.department %}error{% endif %}" 
                    required
                />
                {% if errors.department %}
                <span class="form-error sans"><i data-lucide="alert-circle" class="w-3 h-3"></i> {{ errors.department }}</span>
                {% endif %}
            </div>

            <div class="form-group">
                <label class="form-label sans">
                    <i data-lucide="users" class="w-4 h-4"></i>
                    <span>রেজিস্ট্রেশন ধরন</span>
                </label>
                <select 
                    name="registration_type" 
                    class="form-select sans {% if errors.registration_type %}error{% endif %}"
                    required
                >
                    <option value="" disabled {% if not data.registration_type %}selected{% endif %}>ধরন নির্বাচন করুন</option>
                    {% for value, text in reg_types %}
                    <option value="{{ value }}" {% if data.registration_type == value %}selected{% endif %}>{{ text }}</option>
                    {% endfor %}
                </select>
                {% if errors.registration_type %}
                <span class="form-error sans"><i data-lucide="alert-circle" class="w-3 h-3"></i> {{ errors.registration_type }}</span>
                {% endif %}
            </div>

            <div class="form-group">
                <label class="form-label sans">
                    <i data-lucide="shirt" class="w-4 h-4"></i>
                    <span>টি-শার্ট সাইজ</span>
                </label>
                <select 
                    name="t_shirt_size" 
                    class="form-select sans {% if errors.t_shirt_size %}error{% endif %}"
                    required
                >
                    <option value="" disabled {% if not data.t_shirt_size %}selected{% endif %}>সাইজ নির্বাচন করুন</option>
                    {% for value, text in tshirt_sizes %}
                    <option value="{{ value }}" {% if data.t_shirt_size == value %}selected{% endif %}>{{ text }}</option>
                    {% endfor %}
                </select>
                {% if errors.t_shirt_size %}
                <span class="form-error sans"><i data-lucide="alert-circle" class="w-3 h-3"></i> {{ errors.t_shirt_size }}</span>
                {% endif %}
            </div>

            <div class="form-group lg:col-span-3">
                <label class="form-label sans">
                    <i data-lucide="award" class="w-4 h-4"></i>
                    <span>সর্বশেষ স্কাউট স্তর (Last Scouting Stage)</span>
                </label>
                <select 
                    name="last_scouting_stage" 
                    class="form-select sans {% if errors.last_scouting_stage %}error{% endif %}"
                    required
                >
                    <option value="" disabled {% if not data.last_scouting_stage %}selected{% endif %}>স্তর নির্বাচন করুন</option>
                    {% for value, text in scout_stages %}
                    <option value="{{ value }}" {% if data.last_scouting_stage == value %}selected{% endif %}>{{ text }}</option>
                    {% endfor %}
                </select>
                {% if errors.last_scouting_stage %}
                <span class="form-error sans"><i data-lucide="alert-circle" class="w-3 h-3"></i> {{ errors.last_scouting_stage }}</span>
                {% endif %}
            </div>

            <div class="form-group sm:col-span-2 lg:col-span-3">
                <label class="form-label sans">
                    <i data-lucide="message-square" class="w-4 h-4"></i>
                    <span>প্রোগ্রামের জন্য পরামর্শ (যদি থাকে)</span>
                </label>
                <textarea 
                    name="suggestion" 
                    class="form-textarea sans" 
                    placeholder="আপনার যেকোনো পরামর্শ বা মতামত এখানে লিখুন..." 
                    rows="3"
                >{{ data.suggestion|default:'' }}</textarea>
            </div>
        </div>

        <div class="flex justify-end mt-8">
            <button type="submit" class="form-btn-primary sans group relative overflow-hidden">
                <span class="relative z-10">পরবর্তী ধাপ (পেমেন্ট)</span>
                <i data-lucide="arrow-right" class="w-5 h-5 relative z-10 group-hover:translate-x-1 transition-transform"></i>
            </button>
        </div>
    </form>
</div>

<script>
    // Re-initialize Lucide icons after HTMX swap
    document.addEventListener('htmx:afterSwap', function(event) {
        if (lucide && typeof lucide.createIcons === 'function') {
            lucide.createIcons();
        }
    });
    
    // Initialize icons on load
    if (lucide && typeof lucide.createIcons === 'function') {
        lucide.createIcons();
    }
</script>